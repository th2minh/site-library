<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Mike Mahoney" />

<meta name="date" content="2020-03-23" />

<title>Modular Reporting with heddlr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Modular Reporting with <code>heddlr</code></h1>
<h4 class="author">Mike Mahoney</h4>
<h4 class="date">2020-03-23</h4>



<p>This vignette serves as a basic introduction to the <code>heddlr</code> package, a set of utilities to make it easier to write R Markdown documents with sections that repeat or which might need to add or remove sections based on an underlying data source. In order to demonstrate the essentials of how the package works, let’s imagine we have a super cool R Markdown document, which looks something like this:</p>
<pre><code>---
title: &quot;My cool report!&quot;
author: &quot;Captain heddlr&quot;
output: html_document
---
# Let's talk about irises!

## Iris setosa

This species of flower is great! It has a mean sepal length of 
`.r mean(iris[iris$Species == &quot;setosa&quot;, &quot;Sepal.Length&quot;])`, and a
mean sepal width of `.r mean(iris[iris$Species == &quot;setosa&quot;, &quot;Sepal.Width&quot;])`. 
That looks like this on a graph!

.```{r}
iris %&gt;%
  filter(Species == &quot;setosa&quot;) %&gt;%
  ggplot(aes(Sepal.Length, Sepal.Width)) + 
  geom_point()
.```

## Iris virginica

This species of flower is great! It has a mean sepal length of 
`.r mean(iris[iris$Species == &quot;virginica&quot;, &quot;Sepal.Length&quot;])`, and a
mean sepal width of `.r mean(iris[iris$Species == &quot;virginica&quot;, &quot;Sepal.Width&quot;])`. 
That looks like this on a graph!

.```{r}
iris %&gt;%
  filter(Species == &quot;virginica&quot;) %&gt;%
  ggplot(aes(Sepal.Length, Sepal.Width)) + 
  geom_point()
.```
</code></pre>
<p>This is a great report, and it probably didn’t take that long to create. However, one day Joe down the hall points out that there are actually more types of irises than the ones you’re always talking about - and your database already has information about one called versicolor!</p>
<p>If you wanted, you could go ahead and copy and paste the species section again, making sure to change all the species names to versicolor. However, there’s some level of risk associated with that – you can wind up with errors in your reporting if you miss replacing a value. More importantly, though, is that copying and pasting by hand doesn’t scale to reports which are put out often and need multiple sections added or removed. It can save a lot of time and energy to instead automate that task away.</p>
<p>That’s the motivation behind <code>heddlr</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>: to reduce that repetitive work and, as a side effect, simplify your code. To do so, <code>heddlr</code> looks at reports as a collection of components, which we’ll call patterns. As it happens, our super cool report above is made up of two patterns – first, the setup material:</p>
<pre><code>---
title: &quot;My cool report!&quot;
author: &quot;Captain heddlr&quot;
output: html_document
---

.```{r setup}
library(dplyr)
library(ggplot2)
.```
# Let's talk about irises!
</code></pre>
<p>And secondly the species-specific section, which gets repeated for each species in our dataset – I’ve swapped the specific name out for a placeholder value:</p>
<pre><code>## Iris SPECIES_NAME

This species of flower is great! It has a mean sepal length of 
`.r mean(iris[iris$Species == &quot;SPECIES_NAME&quot;, &quot;Sepal.Length&quot;])`, and a
mean sepal width of `.r mean(iris[iris$Species == &quot;SPECIES_NAME&quot;, &quot;Sepal.Width&quot;])`. 
That looks like this on a graph!

.```{r}
iris %&gt;%
  filter(Species == &quot;SPECIES_NAME&quot;) %&gt;%
  ggplot(aes(Sepal.Length, Sepal.Width)) + 
  geom_point()
.```
</code></pre>
<p>When using <code>heddlr</code>, we’ll usually go ahead and save each of those patterns in their own files – for our example report, we’ll name those files <code>setup_pattern.Rmd</code> and <code>species_pattern.Rmd</code> respectively<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<p>We then have a few ways we can import them into our R session. Let’s load <code>heddlr</code> and then walk through them:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(heddlr)</a></code></pre></div>
<p>The first and most straightforward method is to use <code>heddlr::import_pattern()</code>, which does more or less what you’d expect and imports a single pattern into a single R object.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># These can be any sort of plaintext file -- I tend to save them as .Rmd,</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># so that I can see code highlighting in R Studio with them, but any extension</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># should work fine</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">setup_pattern &lt;-<span class="st"> </span><span class="kw">import_pattern</span>(<span class="st">&quot;setup_pattern.Rmd&quot;</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">species_pattern &lt;-<span class="st"> </span><span class="kw">import_pattern</span>(<span class="st">&quot;species_pattern.Rmd&quot;</span>)</a></code></pre></div>
<p>This gives us objects that contain strings like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">setup_pattern</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [1] &quot;---\ntitle: \&quot;My cool report!\&quot;\nauthor: \&quot;Captain heddlr\&quot;\noutput: html_document\n---\n\n```{r setup}\nlibrary(dplyr)\nlibrary(ggplot2)\n```\n\n# Let's talk about irises!\n\n&quot;</span></a></code></pre></div>
<p>However, it can be helpful in reports with multiple patterns to store everything in one object, just to have fewer things floating around your top-level environment. <code>heddlr</code> provides <code>heddlr::import_draft()</code> for this purpose, wrapping an <code>lapply</code> call which will return a single list object holding all of your patterns:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">iris_draft &lt;-<span class="st"> </span><span class="kw">import_draft</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="st">&quot;setup_pattern&quot;</span> =<span class="st"> &quot;setup_pattern.Rmd&quot;</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="st">&quot;species_pattern&quot;</span> =<span class="st"> &quot;species_pattern.Rmd&quot;</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">)</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">iris_draft</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; $setup_pattern</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; [1] &quot;---\ntitle: \&quot;My cool report!\&quot;\nauthor: \&quot;Captain heddlr\&quot;\noutput: html_document\n---\n\n```{r setup}\nlibrary(dplyr)\nlibrary(ggplot2)\n```\n\n# Let's talk about irises!\n\n&quot;</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; $species_pattern</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; [1] &quot;## Iris SPECIES_NAME\n\nThis species of flower is great! It has a mean sepal length of \n`r mean(iris[iris$Species == \&quot;SPECIES_NAME\&quot;, \&quot;Sepal.Length\&quot;])`, and \nmean sepal width of `r mean(iris[iris$Species == \&quot;SPECIES_NAME\&quot;, \&quot;Sepal.Width\&quot;])`. \nThat looks like this on a graph!\n\n```{r}\niris %&gt;%\n  filter(Species == \&quot;SPECIES_NAME\&quot;) %&gt;%\n  ggplot(aes(Sepal.Length, Sepal.Width)) + \n  geom_point()\n```\n&quot;</span></a></code></pre></div>
<p>Now that we’ve got our patterns into R, it’s time to start working with them. To demonstrate how we do that with <code>heddlr</code>, we first need to load a few libraries:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="kw">library</span>(purrr)</a></code></pre></div>
<p>Our first function that we’ll use to work with patterns is <code>heddlr::heddle()</code>. On the most basic level, this is the function that will replace the placeholders in our patterns with our data. If we have a vector containing the values we want to use for each pattern, we’re able to use this function as follows and get a vector in return:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># heddle takes three arguments: data, pattern, placeholder to replace</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">heddle</span>(<span class="kw">unique</span>(iris<span class="op">$</span>Species), <span class="st">&quot;This is a pattern - CODE &quot;</span>, <span class="st">&quot;CODE&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1] &quot;This is a pattern - setosa &quot;     &quot;This is a pattern - versicolor &quot;</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; [3] &quot;This is a pattern - virginica &quot;</span></a></code></pre></div>
<p>In the context of our example document, this function call would look like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">heddle</span>(<span class="kw">unique</span>(iris<span class="op">$</span>Species), iris_draft<span class="op">$</span>species_pattern, <span class="st">&quot;SPECIES_NAME&quot;</span>)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; [1] &quot;## Iris setosa\n\nThis species of flower is great! It has a mean sepal length of \n`r mean(iris[iris$Species == \&quot;setosa\&quot;, \&quot;Sepal.Length\&quot;])`, and \nmean sepal width of `r mean(iris[iris$Species == \&quot;setosa\&quot;, \&quot;Sepal.Width\&quot;])`. \nThat looks like this on a graph!\n\n```{r}\niris %&gt;%\n  filter(Species == \&quot;setosa\&quot;) %&gt;%\n  ggplot(aes(Sepal.Length, Sepal.Width)) + \n  geom_point()\n```\n&quot;</span></a></code></pre></div>
<p>It isn’t super important, but I think of the outputs from <code>heddle()</code> as being <em>components</em> of a larger <em>template</em>, and will be using similar terminology from here on out.</p>
<p>If we wanted to instead use <code>heddle()</code> as part of a magrittr pipeline, we can create new dataframe columns using <code>dplyr::mutate()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="co"># exact same pattern of arguments: data, pattern, placeholder to replace</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">component =</span> <span class="kw">heddle</span>(Species, iris_draft<span class="op">$</span>species_pattern, <span class="st">&quot;SPECIES_NAME&quot;</span>))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;      Species</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; 1     setosa</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; 2 versicolor</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; 3  virginica</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                       component</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; 1                 ## Iris setosa\n\nThis species of flower is great! It has a mean sepal length of \n`r mean(iris[iris$Species == &quot;setosa&quot;, &quot;Sepal.Length&quot;])`, and \nmean sepal width of `r mean(iris[iris$Species == &quot;setosa&quot;, &quot;Sepal.Width&quot;])`. \nThat looks like this on a graph!\n\n```{r}\niris %&gt;%\n  filter(Species == &quot;setosa&quot;) %&gt;%\n  ggplot(aes(Sepal.Length, Sepal.Width)) + \n  geom_point()\n```\n</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; 2 ## Iris versicolor\n\nThis species of flower is great! It has a mean sepal length of \n`r mean(iris[iris$Species == &quot;versicolor&quot;, &quot;Sepal.Length&quot;])`, and \nmean sepal width of `r mean(iris[iris$Species == &quot;versicolor&quot;, &quot;Sepal.Width&quot;])`. \nThat looks like this on a graph!\n\n```{r}\niris %&gt;%\n  filter(Species == &quot;versicolor&quot;) %&gt;%\n  ggplot(aes(Sepal.Length, Sepal.Width)) + \n  geom_point()\n```\n</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; 3     ## Iris virginica\n\nThis species of flower is great! It has a mean sepal length of \n`r mean(iris[iris$Species == &quot;virginica&quot;, &quot;Sepal.Length&quot;])`, and \nmean sepal width of `r mean(iris[iris$Species == &quot;virginica&quot;, &quot;Sepal.Width&quot;])`. \nThat looks like this on a graph!\n\n```{r}\niris %&gt;%\n  filter(Species == &quot;virginica&quot;) %&gt;%\n  ggplot(aes(Sepal.Length, Sepal.Width)) + \n  geom_point()\n```\n</span></a></code></pre></div>
<p>We can also use <code>heddle()</code> as its own step in a pipeline. When we pass <code>heddle()</code> a dataframe like this, instead of a vector, we have to specify which column we want to replace the placeholder with:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="co"># the data argument is provided by %&gt;%</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span><span class="co"># so we just provide the pattern and placeholder</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="st">  </span><span class="co"># (format &quot;PLACEHOLDER&quot; = Variable)</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="st">  </span><span class="kw">heddle</span>(<span class="st">&quot;This is a pattern - CODE &quot;</span>, <span class="st">&quot;CODE&quot;</span> =<span class="st"> </span>Species)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; [1] &quot;This is a pattern - setosa &quot;     &quot;This is a pattern - versicolor &quot;</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; [3] &quot;This is a pattern - virginica &quot;</span></a></code></pre></div>
<p>An advantage of this method is we can now replace multiple placeholders with our data in a single function call:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw">heddle</span>(<span class="st">&quot;This is a pattern - CODE &quot;</span>, <span class="st">&quot;CODE&quot;</span> =<span class="st"> </span>Species, <span class="st">&quot;This&quot;</span> =<span class="st"> </span>Species)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt; [1] &quot;setosa is a pattern - setosa &quot;        </span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt; [2] &quot;versicolor is a pattern - versicolor &quot;</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; [3] &quot;virginica is a pattern - virginica &quot;</span></a></code></pre></div>
<p>One last way we can use <code>heddle()</code> is to use <code>purrr::map()</code> to apply it to nested columns made via <code>tidyr::nest()</code>. To do so, we just provide arguments in the same way as above:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">nested =</span> Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">component =</span> <span class="kw">map</span>(nested,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    heddle,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="st">&quot;This is a pattern - CODE &quot;</span>,</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    <span class="st">&quot;CODE&quot;</span> =<span class="st"> </span>Species</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">#&gt; # A tibble: 2 x 6</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width nested           component</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;list&gt;           &lt;list&gt;   </span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2 &lt;tibble [1 × 1]&gt; &lt;chr [1]&gt;</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; 2          4.9         3            1.4         0.2 &lt;tibble [1 × 1]&gt; &lt;chr [1]&gt;</span></a></code></pre></div>
<p>This is also the supported way to change multiple placeholder values while saving a component as a column in a dataframe via mutate – nest the columns you’re using to replace placeholders with and then use <code>purrr</code> to replace the placeholders in one step.</p>
<p>You’ll notice that the output of this method is another list column, not the same string column we’re used to seeing as an output. Those familiar with <code>purrr:map()</code> might know that we can get a character output from many dataframes with <code>purrr::map_chr()</code> – however, this doesn’t work with dataframes where you’ll get more than one output from the <code>map()</code> call:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">nested =</span> Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">component =</span> <span class="kw">map_chr</span>(nested, heddle,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">    <span class="st">&quot;This is a pattern - CODE &quot;</span>,</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">    <span class="st">&quot;CODE&quot;</span> =<span class="st"> </span>Species</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">  ))</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co"># &gt; Error: Result 102 must be a single string, not a character vector of length 2</span></a></code></pre></div>
<p>Instead, we can turn to our next function, <code>heddlr::make_template()</code>. There are a few different ways that we can use this function. For our current situation, for instance, we can use <code>purrr::map_chr()</code> to apply <code>make_template()</code> to our new component list column, transforming it into the normal set of strings we’re used to:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">nested =</span> Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    <span class="dt">component =</span> <span class="kw">map</span>(nested, heddle, <span class="st">&quot;This is a pattern - CODE &quot;</span>, <span class="st">&quot;CODE&quot;</span> =<span class="st"> </span>Species),</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">    <span class="dt">component =</span> <span class="kw">map_chr</span>(component, make_template)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; # A tibble: 2 x 6</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width nested     component        </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;list&gt;     &lt;chr&gt;            </span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2 &lt;tibble [… &quot;This is a patte…</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; 2          4.9         3            1.4         0.2 &lt;tibble [… &quot;This is a patte…</span></a></code></pre></div>
<p>In addition to this, there are two other contexts we can use <code>make_template()</code>. If we pass it a dataframe and a vector, it will collapse that vector into a single string:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">nested =</span> Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    <span class="dt">component =</span> <span class="kw">map</span>(nested, heddle,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">      <span class="st">&quot;This is a pattern - CODE &quot;</span>,</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">      <span class="st">&quot;CODE&quot;</span> =<span class="st"> </span>Species</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">    ),</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">    <span class="dt">component =</span> <span class="kw">map_chr</span>(component, make_template)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="st">  </span><span class="kw">make_template</span>(component)</a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; [1] &quot;This is a pattern - setosa This is a pattern - setosa &quot;</span></a></code></pre></div>
<p>If instead the first argument we pass it is a vector, it will combine all the vectors you provide it into a single string:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">make_template</span>(<span class="st">&quot;Part one, &quot;</span>, <span class="st">&quot;part two&quot;</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Part one, part two&quot;</span></a></code></pre></div>
<p>In the context of our example report, these steps would look something like this:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">species_template &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">component =</span> <span class="kw">heddle</span>(</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    Species,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    iris_draft<span class="op">$</span>species_pattern,</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">    <span class="st">&quot;SPECIES_NAME&quot;</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">  )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="st">  </span><span class="kw">make_template</span>(component)</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"></a>
<a class="sourceLine" id="cb20-10" data-line-number="10">report_template &lt;-<span class="st"> </span><span class="kw">make_template</span>(iris_draft<span class="op">$</span>setup_pattern, species_template)</a></code></pre></div>
<p>I refer to these output strings as <em>templates</em>, which are the second to last step in the <code>heddlr</code> pipeline. However, in order to actually create our reports, we need to export these templates to .Rmd files. In order to do that, <code>heddlr</code> provides a helpful function, aptly named <code>heddlr::export_template()</code>. Normally, <code>export_template</code> takes two arguments – the template to write out, and the file to write it out to. Here, I’m going to tell it to print to <code>stdout()</code> instead – that will just output here what our sample report would look like:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">suppressWarnings</span>(<span class="kw">export_template</span>(report_template, <span class="kw">stdout</span>()))</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="co">#&gt; title: &quot;My cool report!&quot;</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">#&gt; author: &quot;Captain heddlr&quot;</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co">#&gt; output: html_document</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; ```{r setup}</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt; library(dplyr)</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; library(ggplot2)</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt; ```</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co">#&gt; # Let's talk about irises!</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="co">#&gt; ## Iris setosa</span></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="co">#&gt; This species of flower is great! It has a mean sepal length of </span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18"><span class="co">#&gt; `r mean(iris[iris$Species == &quot;setosa&quot;, &quot;Sepal.Length&quot;])`, and </span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19"><span class="co">#&gt; mean sepal width of `r mean(iris[iris$Species == &quot;setosa&quot;, &quot;Sepal.Width&quot;])`. </span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20"><span class="co">#&gt; That looks like this on a graph!</span></a>
<a class="sourceLine" id="cb21-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-22" data-line-number="22"><span class="co">#&gt; ```{r}</span></a>
<a class="sourceLine" id="cb21-23" data-line-number="23"><span class="co">#&gt; iris %&gt;%</span></a>
<a class="sourceLine" id="cb21-24" data-line-number="24"><span class="co">#&gt;   filter(Species == &quot;setosa&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb21-25" data-line-number="25"><span class="co">#&gt;   ggplot(aes(Sepal.Length, Sepal.Width)) + </span></a>
<a class="sourceLine" id="cb21-26" data-line-number="26"><span class="co">#&gt;   geom_point()</span></a>
<a class="sourceLine" id="cb21-27" data-line-number="27"><span class="co">#&gt; ```</span></a>
<a class="sourceLine" id="cb21-28" data-line-number="28"><span class="co">#&gt; ## Iris versicolor</span></a>
<a class="sourceLine" id="cb21-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-30" data-line-number="30"><span class="co">#&gt; This species of flower is great! It has a mean sepal length of </span></a>
<a class="sourceLine" id="cb21-31" data-line-number="31"><span class="co">#&gt; `r mean(iris[iris$Species == &quot;versicolor&quot;, &quot;Sepal.Length&quot;])`, and </span></a>
<a class="sourceLine" id="cb21-32" data-line-number="32"><span class="co">#&gt; mean sepal width of `r mean(iris[iris$Species == &quot;versicolor&quot;, &quot;Sepal.Width&quot;])`. </span></a>
<a class="sourceLine" id="cb21-33" data-line-number="33"><span class="co">#&gt; That looks like this on a graph!</span></a>
<a class="sourceLine" id="cb21-34" data-line-number="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-35" data-line-number="35"><span class="co">#&gt; ```{r}</span></a>
<a class="sourceLine" id="cb21-36" data-line-number="36"><span class="co">#&gt; iris %&gt;%</span></a>
<a class="sourceLine" id="cb21-37" data-line-number="37"><span class="co">#&gt;   filter(Species == &quot;versicolor&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb21-38" data-line-number="38"><span class="co">#&gt;   ggplot(aes(Sepal.Length, Sepal.Width)) + </span></a>
<a class="sourceLine" id="cb21-39" data-line-number="39"><span class="co">#&gt;   geom_point()</span></a>
<a class="sourceLine" id="cb21-40" data-line-number="40"><span class="co">#&gt; ```</span></a>
<a class="sourceLine" id="cb21-41" data-line-number="41"><span class="co">#&gt; ## Iris virginica</span></a>
<a class="sourceLine" id="cb21-42" data-line-number="42"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-43" data-line-number="43"><span class="co">#&gt; This species of flower is great! It has a mean sepal length of </span></a>
<a class="sourceLine" id="cb21-44" data-line-number="44"><span class="co">#&gt; `r mean(iris[iris$Species == &quot;virginica&quot;, &quot;Sepal.Length&quot;])`, and </span></a>
<a class="sourceLine" id="cb21-45" data-line-number="45"><span class="co">#&gt; mean sepal width of `r mean(iris[iris$Species == &quot;virginica&quot;, &quot;Sepal.Width&quot;])`. </span></a>
<a class="sourceLine" id="cb21-46" data-line-number="46"><span class="co">#&gt; That looks like this on a graph!</span></a>
<a class="sourceLine" id="cb21-47" data-line-number="47"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-48" data-line-number="48"><span class="co">#&gt; ```{r}</span></a>
<a class="sourceLine" id="cb21-49" data-line-number="49"><span class="co">#&gt; iris %&gt;%</span></a>
<a class="sourceLine" id="cb21-50" data-line-number="50"><span class="co">#&gt;   filter(Species == &quot;virginica&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb21-51" data-line-number="51"><span class="co">#&gt;   ggplot(aes(Sepal.Length, Sepal.Width)) + </span></a>
<a class="sourceLine" id="cb21-52" data-line-number="52"><span class="co">#&gt;   geom_point()</span></a>
<a class="sourceLine" id="cb21-53" data-line-number="53"><span class="co">#&gt; ```</span></a></code></pre></div>
<p>And there we have it! Repeating the above steps will always generate sections for each flower included in your dataset, whether or not Joe down the hall remembered to tell you about it.</p>
<p>To recap, the essential steps to make our report can be summed up as follows:</p>
<ul>
<li>First, we decomposed our report into patterns, saved as individual .Rmd files.</li>
<li>We then imported those files using either <code>import_pattern()</code> or <code>import_draft()</code></li>
<li>We replicated the patterns and replaced placeholders using <code>heddle()</code></li>
<li>We combined those components into templates via <code>make_template()</code></li>
<li>We exported our final template into a report through <code>export_template()</code></li>
</ul>
<p>I’ll usually save these steps into a “generator” file, which I can then run every time I need to regenerate my report. I’ll also often include a step in that file that calls <code>rmarkdown::render()</code> on the generated report file, so that I can just run a single script in order to remake and rebuild my entire report. Obviously, this can be something of an overkill for reports as simple as our example here, but it can be a huge time saver for more complex reports that have more repeating sections, built more often, or are based on more dynamic data sources that require maintenance to add or remove components between builds. It also can help make your code DRYer<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> so you can make edits in a single place and see them replicated across your entire report.</p>
<p>If you want to see this process applied to a somewhat more complicated example, check out how we can make <a href="https://mikemahoney218.github.io/heddlr/flights-example/flights_dashboard.html">this dashboard</a> via <a href="https://mikemahoney218.github.io/heddlr/flights-example/flexdashboards-with-heddlr.html">this article</a>.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>It’s a play on the <a href="https://en.wikipedia.org/wiki/Heddle">loom component</a>, since we’re trying to automate the Sweave/knitr process and someone already took the name <code>loomr</code>. <a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>In order for the vignettes for this package to build correctly, I haven’t actually saved these files off separately – if you look at the source code for this vignette, you’ll notice I’m not actually using the <code>heddlr</code> functions, but rather using some workarounds to get the same exact results. <a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p><a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don’t repeat yourself</a><a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
